<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
var Promise = require('bluebird');
var CacheValue = require('./cache-value');

/**
 * @class CacheResolver
 * @constructor
 * @description
 * In-memory cache. Resolves promises when adding to cache if the key
 * doesn't exist or has expired.
 *
 * @example
 * TODO
 */
function CacheResolver() {
  // cache of promises
  this._cache = {};
}

/**
 * @callback CacheResolver~resolveCallback
 * @description
 * Callback used when cache key does not already exist or has expired.
 * @returns {Promise.&lt;*>}
 */

/**
 * Retrieve `key` from cache. If the `key` doesn't exist, use the provided
 * `callback` to retrieve the value and save to cache. The `callback` function
 * is only executed once if called multiple times in parallel for the same `key`.
 *
 * @param {string} options.key Unique identifier for cache value.
 * @param {CacheResolver~resolveCallback} options.callback Used when cache key undefined or expired.
 * @param {number} [options.expireInSeconds] Number of seconds before expiring cache value.
 */
CacheResolver.prototype.resolve = function(options) {
  // input validation
  if (options.key === null || options.key === undefined || options.key === '') {
    return Promise.reject(new Error('Illegal argument: missing required option `key`.'));
  }
  if (options.callback === null ||  options.callback === undefined) {
    return Promise.reject(new Error('Illegal argument: missing required `callback` function.'));
  }
  // cache value already exists
  if (this._cache[options.key] !== undefined) {
    var value = this._cache[options.key];
    value.expireInSeconds(options.expireInSeconds);
    // cache value has not expired
    var timePassedInSeconds = (new Date().getTime() - value.time()) / 1000;
    if (value.expireInSeconds() === undefined ||
        value.expireInSeconds() === null ||
        timePassedInSeconds &lt; value.expireInSeconds()) {
      return value.promise();
    }
  }
  // cache empty or expired, execute callback
  this._cache[options.key] = new CacheValue(options.callback(), options.expireInSeconds);
  return this._cache[options.key].promise();
};

/**
 * Removes an individual cache value for the given `key`.
 * @param {string} key Unique identifier for cache value.
 */
CacheResolver.prototype.remove = function(key) {
  delete this._cache[key];
};

/**
 * Removes all cache values.
 */
CacheResolver.prototype.flush = function() {
  this._cache = {};
};

module.exports = CacheResolver;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CacheResolver.html">CacheResolver</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sat Jan 02 2016 16:31:52 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
